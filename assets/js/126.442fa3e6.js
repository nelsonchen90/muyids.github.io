(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{506:function(n,s,a){"use strict";a.r(s);var t=a(42),e=Object(t.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("p",[n._v("Go语言实现了"),a("code",[n._v("CSP（通信顺序进程）模型")]),n._v("来作为"),a("code",[n._v("goroutine")]),n._v("间的推荐通信方式")]),n._v(" "),a("h2",{attrs:{id:"并发和并行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#并发和并行"}},[n._v("#")]),n._v(" 并发和并行")]),n._v(" "),a("ul",[a("li",[n._v("并发：同一时间内执行多个任务")]),n._v(" "),a("li",[n._v("并行：同一"),a("strong",[n._v("时刻")]),n._v("执行多个任务")])]),n._v(" "),a("p",[n._v("Go语言的并发通过goroutine实现。goroutine类似于线程，属于用户态的线程。操作系统的线程属于内核级的线程。")]),n._v(" "),a("p",[n._v("我们可以根据需要创建成千上万个goroutine并发工作。")]),n._v(" "),a("h2",{attrs:{id:"golang的csp并发模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#golang的csp并发模型"}},[n._v("#")]),n._v(" golang的CSP并发模型")]),n._v(" "),a("p",[n._v("CSP（Communicating Sequential Process）并发模型，中文可以叫做"),a("strong",[n._v("通信顺序进程")])]),n._v(" "),a("p",[n._v("CSP 模型由并发执行的实体（线程或者进程）所组成，实体之间通过发送消息进行通信，\n这里发送消息时使用的就是通道，或者叫 channel")]),n._v(" "),a("p",[n._v("请记住下面这句话：\nDo not communicate by sharing memory; instead, share memory by communicating.\n"),a("strong",[n._v("不要以共享内存的方式来通信，相反，要通过通信来共享内存。")])]),n._v(" "),a("p",[n._v("普通的线程并发模型，就是像Java、C++、或者Python，他们线程间通信都是通过共享内存的方式来进行的。")]),n._v(" "),a("p",[n._v("非常典型的方式就是，在访问共享数据（例如数组、Map、或者某个结构体或对象）的时候，通过锁来访问，\n因此，在很多时候，衍生出一种方便操作的数据结构，叫做"),a("strong",[n._v("线程安全的数据结构")]),n._v("\n例如Java提供的包”java.util.concurrent”中的数据结构。Go中也实现了传统的线程并发模型。")]),n._v(" "),a("p",[n._v("Go的CSP并发模型，是通过"),a("strong",[n._v("goroutine和channel")]),n._v("来实现的。")]),n._v(" "),a("p",[n._v("goroutine 是Go语言中并发的执行单位。\nchannel 是Go语言中各个并发结构体(goroutine)之前的通信机制。\n通俗的讲，就是各个goroutine之间通信的”管道“，有点类似于Linux中的管道。")]),n._v(" "),a("h2",{attrs:{id:"goroutine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goroutine"}},[n._v("#")]),n._v(" goroutine")]),n._v(" "),a("p",[n._v("go语言中使用goroutine非常简单，只需要在函数前面加上go关键字")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('var wg sync.WaitGroup\n\nfunc say(s string, i int) {\n\tfmt.Println(s, i)\n\twg.Done()\n}\n\nfunc main() {\n\tfor i := 0; i < 1000; i++ {\n\t\twg.Add(1)\n\t\t//go say("hello", i)\n\t\tgo func(i int) {\n\t\t\tfmt.Println(i)\n\t\t\twg.Done()\n\t\t}(i)\n\t}\n\n\twg.Wait()\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br")])]),a("p",[a("strong",[n._v("可增长的栈")])]),n._v(" "),a("p",[n._v("OS线程（操作系统线程）一般都有固定的栈空间（通常为2MB）")]),n._v(" "),a("p",[n._v("goroutine初始状态为2kb, 可以增长到1G")]),n._v(" "),a("p",[a("code",[n._v("runtime.GOMAXPROCS(4)")]),n._v("   // 设置用几个cpu运行代码")]),n._v(" "),a("h2",{attrs:{id:"channel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#channel"}},[n._v("#")]),n._v(" channel")]),n._v(" "),a("p",[n._v("go的并发模型是CSP（Communicating Sequential Processes），提倡"),a("strong",[n._v("通过通信共享内存，而不是通过共享内存而实现通信")])]),n._v(" "),a("p",[n._v("goroutine是go程序并发的执行体，channel是他们之间的连接")]),n._v(" "),a("p",[n._v("channel是可以让一个goroutine发送特定值到另一个goroutine的通信机制")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("var ch1 chan int // 声明一个传递整型的通道\nch1 = make(chan int, 1)\nch1 <- 10 // 发送\nx := <-ch1 // 接收\nclose(ch1) // 关闭通道\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("ch1 = make(chan int, 1) // 带缓冲区通道\nch2 = make(chan int) // 无缓冲区通道，又称为同步通道\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("h2",{attrs:{id:"goroutine-channel-协同工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goroutine-channel-协同工作"}},[n._v("#")]),n._v(" goroutine + channel 协同工作")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("func producer(ch chan int) {\n\tfor i := 0; i < 100; i++ {\n\t\tch <- i\n\t}\n\tclose(ch)\n}\n\nfunc consumer(ch1 chan int, ch2 chan int) {\n\t// 从通道中取值的方式1\n\tfor {\n\t\tvalue, ok := <-ch1\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tch2 <- value * value\n\t}\n\tclose(ch2)\n}\n\nfunc main() {\n\tch1 := make(chan int, 100)\n\tch2 := make(chan int, 100)\n\tgo producer(ch1)\n\tgo consumer(ch1, ch2)\n\n\t// 从通道中取值的方式2\n\tfor ret := range ch2 {\n\t\tfmt.Println(ret)\n\t}\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br")])]),a("p",[a("strong",[n._v("select多路复用")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("select {\n\tcase <-ch1:\n\t\tbreak\n\tcase <-ch2:\n\t\tbreak\n\tdefault:\n        // 默认操作\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);