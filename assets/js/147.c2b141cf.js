(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{580:function(s,a,e){"use strict";e.r(a);var t=e(42),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"基本概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),e("h3",{attrs:{id:"索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[s._v("#")]),s._v(" 索引")]),s._v(" "),e("ul",[e("li",[s._v("索引（index）是Elasticsearch对逻辑数据的逻辑存储，所以它可以分为更小的部分。")]),s._v(" "),e("li",[s._v("可以把索引看成关系型数据库的表，索引的结构是为快速有效的全文索引准备的，特别是它不存储原始值。")]),s._v(" "),e("li",[s._v("Elasticsearch可以把索引存放在一台机器或者分散在多台服务器上，每个索引有一或多个分片（shard），每个分片可以有多个副本（replica）。")])]),s._v(" "),e("h3",{attrs:{id:"文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文档"}},[s._v("#")]),s._v(" 文档")]),s._v(" "),e("ul",[e("li",[s._v("存储在Elasticsearch中的主要实体叫文档（document）。用关系型数据库来类比的话，一个文档相当于数据库\n表中的一行记录。")]),s._v(" "),e("li",[s._v("Elasticsearch和MongoDB中的文档类似，都可以有不同的结构，但Elasticsearch的文档中，相同字段必须有相\n同类型。")]),s._v(" "),e("li",[s._v("文档由多个字段组成，每个字段可能多次出现在一个文档里，这样的字段叫多值字段（multivalued）。")]),s._v(" "),e("li",[s._v("每个字段的类型，可以是文本、数值、日期等。字段类型也可以是复杂类型，一个字段包含其他子文档或者数\n组。")])]),s._v(" "),e("h3",{attrs:{id:"映射"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#映射"}},[s._v("#")]),s._v(" 映射")]),s._v(" "),e("p",[s._v("所有文档写进索引之前都会先进行分析，如何将输入的文本分割为词条、哪些词条又会被过滤，这种行为叫做\n映射（mapping）。一般由用户自己定义规则。")]),s._v(" "),e("h3",{attrs:{id:"文档类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文档类型"}},[s._v("#")]),s._v(" 文档类型")]),s._v(" "),e("ul",[e("li",[s._v("在Elasticsearch中，一个索引对象可以存储很多不同用途的对象。例如，一个博客应用程序可以保存文章和评\n论。")]),s._v(" "),e("li",[s._v("每个文档可以有不同的结构。")]),s._v(" "),e("li",[s._v("不同的文档类型不能为相同的属性设置不同的类型。例如，在同一索引中的所有文档类型中，一个叫title的字段\n必须具有相同的类型。")])]),s._v(" "),e("h2",{attrs:{id:"restful-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#restful-api"}},[s._v("#")]),s._v(" RESTful API")]),s._v(" "),e("p",[s._v("在Elasticsearch中，提供了功能丰富的RESTful API的操作，包括基本的CRUD、创建索引、删除索引等操作。")]),s._v(" "),e("h3",{attrs:{id:"创建非结构化索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建非结构化索引"}},[s._v("#")]),s._v(" 创建非结构化索引")]),s._v(" "),e("p",[s._v("在Lucene中，创建索引是需要定义字段名称以及字段的类型的，在Elasticsearch中提供了非结构化的索引，就是不\n需要创建索引结构，即可写入数据到索引中，实际上在Elasticsearch底层会进行结构化操作，此操作对用户是透明\n的。")]),s._v(" "),e("p",[s._v("创建空索引：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('PUT: http://129.0.4.37:9200/test\n\n{\n    "settings": {\n        "index": {\n            "number_of_shards": "5",\n            "number_of_replicas": "1"\n        }\n    }\n}\n\n#删除索引 \n\nDELETE /test\n\n{ "acknowledged": true }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"插入数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#插入数据"}},[s._v("#")]),s._v(" 插入数据")]),s._v(" "),e("blockquote",[e("p",[s._v("URL规则：\nPOST /{索引}/{类型}/{id}")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('POST /haoke/user/1001 \n\n#数据 \n{ "id":1001, "name":"张三", "age":20, "sex":"男" }\n\n#响应 \n\n{ "_index": "haoke", "_type": "user", "_id": "1", "_version": 1, "result": "created", "_shards": { "total": 1, "successful": 1, "failed": 0 },"_seq_no": 0, "_primary_term": 1 }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("说明：")]),s._v(" "),e("ul",[e("li",[s._v("非结构化的索引，不需要事先创建，直接插入数据默认创建索引。")]),s._v(" "),e("li",[s._v("指定id插入数据，使用id作为_id；不指定id插入数据：自动生成_id")])]),s._v(" "),e("h3",{attrs:{id:"更新数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新数据"}},[s._v("#")]),s._v(" 更新数据")]),s._v(" "),e("p",[s._v("在Elasticsearch中，文档数据是不被修改的，但是可以通过覆盖的方式进行更新。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('PUT /haoke/user/1001 \n\n{ "id":1001, "name":"张三", "age":21, "sex":"女" }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("问题：es可以局部更新吗？ -- 可以的。")]),s._v(" "),e("p",[s._v("前面不是说，文档数据不能更新吗？ 其实是这样的：\n在内部，依然会查询到这个文档数据，然后进行覆盖操作，步骤如下：")]),s._v(" "),e("ol",[e("li",[s._v("从旧文档中检索JSON")]),s._v(" "),e("li",[s._v("修改它")]),s._v(" "),e("li",[s._v("删除旧文档")]),s._v(" "),e("li",[s._v("索引新文档")])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#注意：这里多了_update标识 \n\nPOST /haoke/user/1001/_update \n\n{"doc":{ "age":23 } }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"删除数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除数据"}},[s._v("#")]),s._v(" 删除数据")]),s._v(" "),e("p",[s._v("在Elasticsearch中，删除文档数据，只需要发起DELETE请求即可。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELETE /haoke/user/1001\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("需要注意的是，result表示已经删除，version也增加了。\n如果删除一条不存在的数据，会响应404：")]),s._v(" "),e("p",[s._v("说明：")]),s._v(" "),e("p",[s._v("删除一个文档也不会立即从磁盘上移除，它只是被标记成已删除。Elasticsearch将会在你之后添加更多索引的\n时候才会在后台进行删除内容的清理。")]),s._v(" "),e("h3",{attrs:{id:"搜索数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搜索数据"}},[s._v("#")]),s._v(" 搜索数据")]),s._v(" "),e("h4",{attrs:{id:"根据id搜索数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#根据id搜索数据"}},[s._v("#")]),s._v(" 根据id搜索数据")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("GET /haoke/user/BbPe_WcB9cFOnF3uebvr\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"搜索全部数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搜索全部数据"}},[s._v("#")]),s._v(" 搜索全部数据")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("GET /haoke/user/_search\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("默认返回10条数据")]),s._v(" "),e("h4",{attrs:{id:"关键字搜素数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关键字搜素数据"}},[s._v("#")]),s._v(" 关键字搜素数据")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#查询年龄等于20的用户 \nGET /haoke/user/_search?q=age:20\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"dsl搜索"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dsl搜索"}},[s._v("#")]),s._v(" DSL搜索")]),s._v(" "),e("p",[s._v("Elasticsearch提供丰富且灵活的查询语言叫做"),e("strong",[s._v("DSL查询(Query DSL)")]),s._v(",它允许你构建更加复杂、强大的查询。\n**DSL(Domain Specific Language特定领域语言)**以JSON请求体的形式出现。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('POST /haoke/user/_search \n\n#请求体\n\n{ "query" : { "match" : { "age" : 20 } } }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);