(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{478:function(s,a,t){"use strict";t.r(a);var e=t(42),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("koa相比express主要就是引入了"),t("code",[s._v("generator")]),s._v('，来避免回调"地狱"问题。')]),s._v(" "),t("p",[s._v("nodejs的web框架，我喜欢express，简洁易用。")]),s._v(" "),t("p",[s._v("但是express一个明显的不足，当应用存在大量回调逻辑时，不管是通过callback还是通过"),t("code",[s._v("promise + generator")]),s._v("的方式，异步流程的代码书写都不是特别直观。")]),s._v(" "),t("p",[s._v("于是，tj大神领导开发了下一代web框架"),t("a",{attrs:{href:"https://github.com/koajs/koa",target:"_blank",rel:"noopener noreferrer"}},[s._v("koa"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("Koa 应用是一个包含中间件 generator 方法数组的对象")]),s._v(" "),t("p",[s._v("当请求到来时, 这些方法会以 stack-like 的顺序执行, 从这个角度来看，Koa 和其他中间件系统（比如 Ruby Rack 或者 Connect/Express ）非常相似.")]),s._v(" "),t("p",[s._v("Koa 的一大设计理念是: 通过其他底层中间件层提供高级「语法糖」，而不是Koa.")]),s._v(" "),t("p",[s._v("大大提高了框架的互操作性和健壮性, 并让中间件开发变得简单有趣.")]),s._v(" "),t("h2",{attrs:{id:"中间件架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中间件架构"}},[s._v("#")]),s._v(" 中间件架构")]),s._v(" "),t("p",[s._v("代码级联（Cascading）")]),s._v(" "),t("p",[s._v("比如内容协商（content-negotation）、缓存控制（cache freshness）、反向代理（proxy support）重定向等常见功能都由中间件来实现.")]),s._v(" "),t("p",[s._v("将类似常见任务分离给中间件实现, Koa 实现了异常精简的代码.")]),s._v(" "),t("h3",{attrs:{id:"中间件举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中间件举例"}},[s._v("#")]),s._v(" 中间件举例")]),s._v(" "),t("ul",[t("li",[s._v("koa-router")]),s._v(" "),t("li",[s._v("trie-router")]),s._v(" "),t("li",[s._v("route")]),s._v(" "),t("li",[s._v("basic-auth")]),s._v(" "),t("li",[s._v("etag")]),s._v(" "),t("li",[s._v("compose")]),s._v(" "),t("li",[s._v("static")]),s._v(" "),t("li",[s._v("static-cache")]),s._v(" "),t("li",[s._v("session")]),s._v(" "),t("li",[s._v("compress")]),s._v(" "),t("li",[s._v("csrf")]),s._v(" "),t("li",[s._v("logger")]),s._v(" "),t("li",[s._v("mount")]),s._v(" "),t("li",[s._v("send")])]),s._v(" "),t("p",[s._v("generator functions 以 function* 声明。以这种关键词声明的函数支持 yield。")]),s._v(" "),t("h2",{attrs:{id:"koa与express的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#koa与express的区别"}},[s._v("#")]),s._v(" koa与express的区别")]),s._v(" "),t("ul",[t("li",[s._v("koa采用ctx一个参数来调用中间件，而不是express的req, res。koa更方便。")]),s._v(" "),t("li",[s._v('koa相比express主要就是引入了generator，来避免回调"地狱"问题.')]),s._v(" "),t("li",[s._v("koa的编程模型是一种 栈 模型 ，而express的设计是串联的")]),s._v(" "),t("li",[s._v("express 的社区比较早，生态比koa要成熟。")])]),s._v(" "),t("h3",{attrs:{id:"举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#举例"}},[s._v("#")]),s._v(" 举例")]),s._v(" "),t("p",[s._v("比如一个服务器处理时间/日志的中间件的开发：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("express")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("request进来，记录时间到"),t("code",[s._v("request._startTime")]),s._v("上。绑定一个函数到response的"),t("code",[s._v("end")]),s._v(","),t("code",[s._v("finish")]),s._v("以及response.socket的"),t("code",[s._v("error")]),s._v(","),t("code",[s._v("close")]),s._v("事件上。")])]),s._v(" "),t("li",[t("p",[s._v("那个函数会用当前时间和startTime做差，算出运行时间。")])])])]),s._v(" "),t("li",[t("p",[s._v("koa2")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("xTime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Response-Time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ms'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("p",[s._v("这是在功能开发上，在错误处理上的友好度就更高了。")]),s._v(" "),t("p",[s._v("没有特意抹黑express的中间件开发，那个express版的计时器是express自带的服务器日志中间件morgan的实现。")]),s._v(" "),t("h3",{attrs:{id:"社区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#社区"}},[s._v("#")]),s._v(" 社区")]),s._v(" "),t("p",[s._v("express的社区还是大。")]),s._v(" "),t("p",[s._v("koa本来就小，还被从koa1转koa2一折腾，就更小了。")]),s._v(" "),t("p",[s._v("听说koa组表示async被纳入es7准则前，不会发布kao2的正式版。")]),s._v(" "),t("p",[s._v("个人推荐用能力的同学还是选择koa2，做先吃螃蟹的人。")]),s._v(" "),t("h2",{attrs:{id:"koa与koa2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#koa与koa2"}},[s._v("#")]),s._v(" koa与koa2")]),s._v(" "),t("p",[s._v("koa2 完全抛弃了generator和co的做法，而是使用async/await来做异步开发。")]),s._v(" "),t("p",[s._v("V8引擎从5.5版本开始原生支持async-await，nodejs版本为7.6.0")])])}),[],!1,null,null,null);a.default=r.exports}}]);