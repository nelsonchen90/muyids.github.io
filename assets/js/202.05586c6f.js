(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{356:function(e,s,t){"use strict";t.r(s);var a=t(42),l=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"redis的过期策略以及内存淘汰机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis的过期策略以及内存淘汰机制"}},[e._v("#")]),e._v(" Redis的过期策略以及内存淘汰机制")]),e._v(" "),t("h3",{attrs:{id:"过期策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#过期策略"}},[e._v("#")]),e._v(" 过期策略")]),e._v(" "),t("p",[e._v("Redis 采用的是"),t("strong",[e._v("定期删除+懒汉式删除")]),e._v("策略。")]),e._v(" "),t("p",[e._v("定期删除，Redis 默认每隔 100ms 检查，是否有过期的 Key，有过期 Key 则删除(类似小顶堆实现)")]),e._v(" "),t("p",[e._v("惰性删除，获取某个 Key 的时候，Redis 会检查一下，这个 Key 如果设置了过期时间，如果过期了此时就会删除。")]),e._v(" "),t("h3",{attrs:{id:"内存淘汰机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存淘汰机制"}},[e._v("#")]),e._v(" 内存淘汰机制")]),e._v(" "),t("p",[e._v("如果没有过期的Key被定期删除或者懒汉式删除，内存不断增长，怎么办？")]),e._v(" "),t("p",[e._v("在 redis.conf 中有一行配置：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# maxmemory-policy volatile-lru")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("六种内存淘汰策略：")]),e._v(" "),t("ul",[t("li",[e._v("noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。应该没人用吧。")]),e._v(" "),t("li",[t("strong",[e._v("allkeys-lru")]),e._v("：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的 Key。推荐使用，目前项目在用这种。")]),e._v(" "),t("li",[e._v("allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个 Key。应该也没人用吧，你不删最少使用 Key，去随机删。")]),e._v(" "),t("li",[e._v("volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的 Key。这种情况一般是把 Redis 既当缓存，又做持久化存储的时候才用。不推荐。")]),e._v(" "),t("li",[e._v("volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个 Key。依然不推荐。")]),e._v(" "),t("li",[e._v("volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的 Key 优先移除。不推荐。")])]),e._v(" "),t("p",[e._v("推荐使用：allkeys-lru")])])}),[],!1,null,null,null);s.default=l.exports}}]);