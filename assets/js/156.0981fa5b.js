(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{446:function(t,e,a){"use strict";a.r(e);var s=a(42),_=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("code",[t._v("influxdb")]),t._v("是目前比较流行的时间序列数据库。")]),t._v(" "),a("p",[a("em",[t._v("何谓时间序列数据库？")])]),t._v(" "),a("p",[t._v("什么是时间序列数据库，最简单的定义就是数据格式里包含Timestamp字段的数据，比如某一时间环境的温度，CPU的使用率等。\n但是，有什么数据不包含Timestamp呢？几乎所有的数据其实都可以打上一个Timestamp字段。时间序列数据的更重要的一个属性是如何去查询它，包括数据的过滤，计算等等。")]),t._v(" "),a("h2",{attrs:{id:"influxdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#influxdb"}},[t._v("#")]),t._v(" Influxdb")]),t._v(" "),a("p",[t._v("Influxdb是一个开源的分布式时序、时间和指标数据库，使用go语言编写，无需外部依赖。")]),t._v(" "),a("p",[t._v("它有三大特性：")]),t._v(" "),a("ul",[a("li",[t._v("时序性（Time Series）：与时间相关的函数的灵活使用（诸如最大、最小、求和等）；")]),t._v(" "),a("li",[t._v("度量（Metrics）：对实时大量数据进行计算；")]),t._v(" "),a("li",[t._v("事件（Event）：支持任意的事件数据，换句话说，任意事件的数据我们都可以做操作。")])]),t._v(" "),a("p",[t._v("同时，它有以下几大特点：")]),t._v(" "),a("ul",[a("li",[t._v("schemaless(无结构)，可以是任意数量的列；")]),t._v(" "),a("li",[t._v("min, max, sum, count, mean, median 一系列函数，方便统计；")]),t._v(" "),a("li",[t._v("Native HTTP API, 内置http支持，使用http读写；")]),t._v(" "),a("li",[t._v("Powerful Query Language 类似sql；")]),t._v(" "),a("li",[t._v("Built-in Explorer 自带管理工具。")])]),t._v(" "),a("h2",{attrs:{id:"influxdb安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#influxdb安装"}},[t._v("#")]),t._v(" Influxdb安装")]),t._v(" "),a("p",[t._v("在讲解具体的安装步骤之前，先说说influxdb的两个http端口：8083和8086")]),t._v(" "),a("ul",[a("li",[t._v("port 8083：管理页面端口，访问localhost:8083可以进入你本机的influxdb管理页面；")]),t._v(" "),a("li",[t._v("port 8086：http连接influxdb client端口，一般使用该端口往本机的influxdb读写数据。")])]),t._v(" "),a("h3",{attrs:{id:"os-x"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#os-x"}},[t._v("#")]),t._v(" OS X")]),t._v(" "),a("p",[t._v("brew update\nbrew install influxdb")]),t._v(" "),a("h3",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" docker")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -d --restart=always \\\n\t -p 8083:8083 -e INFLUXDB_ADMIN_ENABLED=true \\\n\t -p 8086:8086 \\\n      -v /var/lib/influxdb:/var/lib/influxdb \\\n      influxdb\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h3",{attrs:{id:"redhat-centos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redhat-centos"}},[t._v("#")]),t._v(" RedHat & CentOS")]),t._v(" "),a("p",[t._v("wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2.x86_64.rpm\nsudo yum localinstall influxdb-1.0.2.x86_64.rpm")]),t._v(" "),a("p",[t._v("安装完之后，如何启动呢？")]),t._v(" "),a("ul",[a("li",[t._v("sudo service influxdb start")]),t._v(" "),a("li",[t._v("/etc/init.d/influxdb restart")])]),t._v(" "),a("p",[t._v("如何在命令行使用")]),t._v(" "),a("p",[t._v("安装完毕之后，如何在命令行使用呢？")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("influx\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("influx -precision rfc3339")]),t._v(" "),a("h2",{attrs:{id:"influxdb基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#influxdb基本操作"}},[t._v("#")]),t._v(" influxdb基本操作")]),t._v(" "),a("p",[t._v("名词解释")]),t._v(" "),a("p",[t._v("在具体的讲解influxdb的相关操作之前先说说influxdb的一些专有名词，这些名词代表什么。")]),t._v(" "),a("p",[t._v("influxdb相关名词")]),t._v(" "),a("ul",[a("li",[t._v("database：数据库；")]),t._v(" "),a("li",[t._v("measurement：数据库中的表；")]),t._v(" "),a("li",[t._v("points：表里面的一行数据。")])]),t._v(" "),a("p",[t._v("influxDB中独有的一些概念")]),t._v(" "),a("p",[t._v("Point由时间戳（time）、数据（field）和标签（tags）组成。")]),t._v(" "),a("ul",[a("li",[t._v("time：每条数据记录的时间，也是数据库自动生成的主索引；")]),t._v(" "),a("li",[t._v("fields：各种记录的值；")]),t._v(" "),a("li",[t._v("tags：各种有索引的属性。")])]),t._v(" "),a("p",[t._v("还有一个重要的名词：series")]),t._v(" "),a("p",[t._v("所有在数据库中的数据，都需要通过图表来表示，series表示这个表里面的所有的数据可以在图标上画成几条线（注：线条的个数由tags排列组合计算出来）")]),t._v(" "),a("h3",{attrs:{id:"influxdb基本操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#influxdb基本操作-2"}},[t._v("#")]),t._v(" influxdb基本操作")]),t._v(" "),a("p",[t._v("数据库与表的操作\n可以直接在web管理页面做操作，当然也可以命令行。")]),t._v(" "),a("h4",{attrs:{id:"创建数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建数据库"}},[t._v("#")]),t._v(" 创建数据库")]),t._v(" "),a("p",[t._v('create database "db_name"')]),t._v(" "),a("h4",{attrs:{id:"显示所有的数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显示所有的数据库"}},[t._v("#")]),t._v(" 显示所有的数据库")]),t._v(" "),a("p",[t._v("show databases")]),t._v(" "),a("h4",{attrs:{id:"删除数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库"}},[t._v("#")]),t._v(" 删除数据库")]),t._v(" "),a("p",[t._v('drop database "db_name"')]),t._v(" "),a("h4",{attrs:{id:"使用数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用数据库"}},[t._v("#")]),t._v(" 使用数据库")]),t._v(" "),a("p",[t._v("use db_name")]),t._v(" "),a("h4",{attrs:{id:"显示该数据库中所有的表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显示该数据库中所有的表"}},[t._v("#")]),t._v(" 显示该数据库中所有的表")]),t._v(" "),a("p",[t._v("show measurements")]),t._v(" "),a("h4",{attrs:{id:"创建表，直接在插入数据的时候指定表名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建表，直接在插入数据的时候指定表名"}},[t._v("#")]),t._v(" 创建表，直接在插入数据的时候指定表名")]),t._v(" "),a("p",[t._v("insert test,host=127.0.0.1,monitor_name=test count=1")]),t._v(" "),a("h4",{attrs:{id:"删除表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除表"}},[t._v("#")]),t._v(" 删除表")]),t._v(" "),a("p",[t._v('drop measurement "measurement_name"')]),t._v(" "),a("h4",{attrs:{id:"增"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增"}},[t._v("#")]),t._v(" 增")]),t._v(" "),a("p",[t._v("向数据库中插入数据。")]),t._v(" "),a("p",[t._v("通过命令行")]),t._v(" "),a("ul",[a("li",[t._v("use testDb")]),t._v(" "),a("li",[t._v("insert test,host=127.0.0.1,monitor_name=test count=1")])]),t._v(" "),a("p",[t._v("通过http接口")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("curl -i -XPOST 'http://127.0.0.1:8086/write?db=testDb' --data-binary 'test,host=127.0.0.1,monitor_name=test count=1'\n")])])]),a("p",[t._v("读者看到这里可能会观察到插入的数据的格式貌似比较奇怪，这是因为influxDB存储数据采用的是Line Protocol格式。那么何谓Line Protoco格式？")]),t._v(" "),a("p",[t._v("Line Protocol格式：写入数据库的Point的固定格式。")]),t._v(" "),a("p",[t._v("在上面的两种插入数据的方法中都有这样的一部分：")]),t._v(" "),a("p",[t._v("test,host=127.0.0.1,monitor_name=test count=1")]),t._v(" "),a("p",[t._v("其中：")]),t._v(" "),a("ul",[a("li",[t._v("test：表名；")]),t._v(" "),a("li",[t._v("host=127.0.0.1,monitor_name=test：tag；")]),t._v(" "),a("li",[t._v("count=1：field")])]),t._v(" "),a("p",[t._v("想对此格式有详细的了解参见"),a("a",{attrs:{href:"https://docs.influxdata.com/influxdb/v1.6/write_protocols/line_protocol_tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查"}},[t._v("#")]),t._v(" 查")]),t._v(" "),a("p",[t._v("查询数据库中的数据。")]),t._v(" "),a("p",[t._v("通过命令行\nselect * from test order by time desc")]),t._v(" "),a("p",[t._v('通过http接口\ncurl -G \'http://localhost:8086/query?pretty=true\' --data-urlencode "db=testDb" --data-urlencode "q=select * from test order by time desc"')]),t._v(" "),a("p",[t._v("influxDB是支持类sql语句的，具体的查询语法都差不多，这里就不再做详细的赘述了。")]),t._v(" "),a("h4",{attrs:{id:"数据保存策略（retention-policies）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据保存策略（retention-policies）"}},[t._v("#")]),t._v(" 数据保存策略（Retention Policies）")]),t._v(" "),a("p",[t._v("influxDB是没有提供直接删除数据记录的方法，但是提供数据保存策略，主要用于指定数据保留时间，超过指定时间，就删除这部分数据。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("查看当前数据库Retention Policies")]),t._v(" "),a("p",[t._v('show retention policies on "db_name"')])]),t._v(" "),a("li",[a("p",[t._v('创建新的Retention Policies\ncreate retention policy "rp_name" on "db_name" duration 3w replication 1 default')]),t._v(" "),a("ul",[a("li",[t._v("rp_name：策略名；")]),t._v(" "),a("li",[t._v("db_name：具体的数据库名；")]),t._v(" "),a("li",[t._v("3w：保存3周，3周之前的数据将被删除，influxdb具有各种事件参数，比如：h（小时），d（天），w（星期）；")]),t._v(" "),a("li",[t._v("replication 1：副本个数，一般为1就可以了；")]),t._v(" "),a("li",[t._v("default：设置为默认策略")])])]),t._v(" "),a("li",[a("p",[t._v('修改Retention Policies\nalter retention policy "rp_name" on "db_name" duration 30d default')])]),t._v(" "),a("li",[a("p",[t._v('删除Retention Policies\ndrop retention policy "rp_name"')])])]),t._v(" "),a("h4",{attrs:{id:"用户管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[t._v("#")]),t._v(" 用户管理")]),t._v(" "),a("p",[t._v("可以直接在web管理页面做操作，也可以命令行。")]),t._v(" "),a("ul",[a("li",[t._v("显示用户\nshow users")]),t._v(" "),a("li",[t._v("创建用户\ncreate user \"username\" with password 'password'")]),t._v(" "),a("li",[t._v("创建管理员权限用户\ncreate user \"username\" with password 'password' with all privileges")]),t._v(" "),a("li",[t._v('删除用户\ndrop user "username"')])])])}),[],!1,null,null,null);e.default=_.exports}}]);